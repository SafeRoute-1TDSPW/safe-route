<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeRoute Cidadão</title>
    <link rel="stylesheet" href="styles-mobile.css">
</head>
<body>
    <div class="mobile-app-container">
        <!-- Conteúdo das Páginas -->
        <main class="main-content-area">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page active">
                <h1 class="page-title">Olá, Cidadão!</h1>

                <!-- Cartão de Alertas Ativos -->
                <div class="card alert-card">
                    <span class="icon-placeholder large-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell-ring"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.36 17.06a2 2 0 1 0 3.28 0"/><path d="M12 21v-4"/></svg>
                    </span>
                    <div>
                        <h2 class="card-title">Alerta de Emergência!</h2>
                        <p class="card-description">Chuvas intensas nas próximas 6 horas. Evite áreas de risco.</p>
                    </div>
                </div>

                <!-- Botões de Ação Rápida -->
                <div class="action-buttons-grid">
                    <button id="btn-estou-seguro" class="button success-button">
                        <span class="icon-placeholder large-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>
                        </span>
                        <span class="button-text">Estou Seguro</span>
                    </button>
                    <button id="btn-preciso-ajuda" class="button warning-button">
                        <span class="icon-placeholder large-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-alert-triangle"><path d="m21.73 18.73-8-13.9a2 2 0 0 0-3.46 0l-8 13.9A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3.27Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
                        </span>
                        <span class="button-text">Preciso de Ajuda</span>
                    </button>
                </div>

                <!-- Simulação de Localização para Teste -->
                <div class="card location-simulator-card">
                    <h2 class="section-title">Simular Localização:</h2>
                    <p class="section-description">Clique para testar notificações de proximidade a abrigos.</p>
                    <div class="location-buttons">
                        <button id="btn-simulate-near" class="button primary-button small-button">
                            Simular Próximo ao Abrigo (5km)
                        </button>
                        <button id="btn-simulate-far" class="button secondary-button small-button">
                            Simular Localização Longe
                        </button>
                    </div>
                    <p id="user-location-display" class="location-display-text hidden"></p>
                </div>

                <!-- Abrigos Próximos -->
                <div class="card">
                    <h2 class="section-title">Abrigos Próximos:</h2>
                    <ul id="nearby-shelters-list" class="list-items">
                        <li class="list-item-placeholder">Simule sua localização para ver abrigos próximos.</li>
                    </ul>
                </div>

                <!-- Histórico de Notificações -->
                <div class="card">
                    <h2 class="section-title">Notificações:</h2>
                    <ul id="notifications-history-list" class="list-items">
                        <li class="list-item-placeholder">Nenhuma notificação ainda.</li>
                    </ul>
                </div>
            </div>

            <!-- Shelters Page -->
            <div id="shelters-page" class="page">
                <h1 class="page-title">Abrigos</h1>
                <p class="page-description">Detalhes e navegação para abrigos serão implementados aqui.</p>
                <ul id="shelters-list-all" class="list-items all-shelters-list">
                    <!-- Abrigos serão injetados via JS -->
                </ul>
            </div>
            <!-- Notifications List Page -->
            <div id="notifications-list-page" class="page">
                <h1 class="page-title">Minhas Notificações</h1>
                <p class="page-description">Todas as notificações recebidas serão listadas aqui.</p>
                <ul id="full-notifications-list" class="list-items">
                     <li class="list-item-placeholder">Nenhuma notificação ainda.</li>
                </ul>
            </div>

            <!-- Profile Page -->
            <div id="profile-page" class="page">
                <h1 class="page-title">Meu Perfil</h1>
                <div class="card profile-card">
                    <div class="profile-header">
                        <span class="icon-placeholder profile-avatar">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        </span>
                        <div>
                            <p class="profile-name">Nome do Usuário</p>
                            <p class="profile-email">contato@email.com</p>
                        </div>
                    </div>
                    <p class="profile-description">Configurações de emergência e contatos.</p>
                    <button class="button primary-button">Editar Perfil</button>
                </div>
            </div>
        </main>

        <!-- Barra de Navegação Inferior -->
        <nav class="bottom-nav">
            <button id="nav-dashboard" class="nav-button">
                <span class="icon-placeholder">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-home"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                </span>
                <span class="nav-button-text">Início</span>
            </button>
            <button id="nav-shelters" class="nav-button">
                <span class="icon-placeholder">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                </span>
                <span class="nav-button-text">Abrigos</span>
            </button>
            <button id="nav-notifications" class="nav-button">
                <span class="icon-placeholder">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell-ring"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.36 17.06a2 2 0 1 0 3.28 0"/><path d="M12 21v-4"/></svg>
                </span>
                <span class="nav-button-text">Alertas</span>
            </button>
            <button id="nav-profile" class="nav-button">
                <span class="icon-placeholder">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                </span>
                <span class="nav-button-text">Perfil</span>
            </button>
        </nav>
    </div>
    <!-- Modal de Notificação -->
    <div id="notification-modal-overlay" class="modal-overlay">
        <div class="modal-content">
            <span id="modal-icon" class="icon-placeholder large-icon modal-icon"></span>
            <h3 id="modal-title" class="modal-title"></h3>
            <p id="modal-message" class="modal-message"></p>
            <button id="modal-close-button" class="button primary-button modal-button">
                OK
            </button>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Referências de elementos
            const pages = document.querySelectorAll('.page');
            const navButtons = document.querySelectorAll('.bottom-nav .nav-button');
            const notificationModalOverlay = document.getElementById('notification-modal-overlay');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalIcon = document.getElementById('modal-icon');
            const modalCloseButton = document.getElementById('modal-close-button');
            const btnSimulateNear = document.getElementById('btn-simulate-near');
            const btnSimulateFar = document.getElementById('btn-simulate-far');
            const userLocationDisplay = document.getElementById('user-location-display');
            const nearbySheltersList = document.getElementById('nearby-shelters-list');
            const notificationsHistoryList = document.getElementById('notifications-history-list');
            const fullNotificationsList = document.getElementById('full-notifications-list');
            const allSheltersList = document.getElementById('shelters-list-all');

            let userLocation = null;
            let notifications = []; // Histórico de notificações
// Dados mock de abrigos (Nome, Lat, Lng, Capacidade, Ocupação)
const mockShelters = [
                { id: 's1', name: 'Escola Central', lat: -23.55052, lng: -46.633309, capacity: 500, occupied: 150, status: 'Aberto' },
                { id: 's2', name: 'Ginásio Comunitário', lat: -23.56010, lng: -46.650000, capacity: 300, occupied: 280, status: 'Quase Cheio' },
                { id: 's3', name: 'Centro Cultural', lat: -23.57000, lng: -46.640000, capacity: 200, occupied: 50, status: 'Aberto' },
                { id: 's4', name: 'Ponto de Apoio Remoto', lat: -23.40000, lng: -46.500000, capacity: 100, occupied: 10, status: 'Aberto' },
                { id: 's5', name: 'Abrigo de Emergência Urbano', lat: -23.55000, lng: -46.634000, capacity: 400, occupied: 0, status: 'Aberto' }, // Muito perto do ponto de simulação
            ];

            // Função para calcular a distância entre duas coordenadas (Haversine Formula simplificada)
            const calculateDistance = (lat1, lon1, lat2, lon2) => {
                const R = 6371; // Raio da Terra em km
                const dLat = (lat2 - lat1) * (Math.PI / 180);
                const dLon = (lon2 - lon1) * (Math.PI / 180);
                const a =
                    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(lat1 * (Math.PI / 180)) * Math.cos(lat2 * (Math.PI / 180)) *
                    Math.sin(dLon / 2) * Math.sin(dLon / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                return R * c;
            };

            // Função para mostrar o modal de notificação
            function showNotificationModal(title, message, iconSVG, iconColorClass = 'primary-blue-icon') {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                modalIcon.innerHTML = iconSVG; // Insere o SVG diretamente
                modalIcon.className = 'icon-placeholder large-icon modal-icon ' + iconColorClass; // Aplica classes CSS

                notificationModalOverlay.classList.add('show');
            }
            
            // Função para fechar o modal de notificação
            function closeNotificationModal() {
                notificationModalOverlay.classList.remove('show');
            }

            // Função para renderizar a lista de abrigos próximos
            function renderNearbyShelters() {
                nearbySheltersList.innerHTML = ''; // Limpa a lista existente

                if (!userLocation) {
                    nearbySheltersList.innerHTML = '<li class="list-item-placeholder">Simule sua localização para ver abrigos próximos.</li>';
                    return;
                }

                const nearby = mockShelters.filter(shelter => {
                    const distance = calculateDistance(userLocation.lat, userLocation.lng, shelter.lat, shelter.lng);
                    return distance <= 20; // Mostra abrigos até 20km para demonstração
                });

                if (nearby.length === 0) {
                    nearbySheltersList.innerHTML = '<li class="list-item-placeholder">Nenhum abrigo próximo encontrado (dentro de 20km).</li>';
                } else {
                    nearby.forEach(shelter => {
                        const distance = calculateDistance(userLocation.lat, userLocation.lng, shelter.lat, shelter.lng);
                        const listItem = document.createElement('li');
                        listItem.className = 'list-item';
                        listItem.innerHTML = `
                            <span class="icon-placeholder small-icon blue-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                            </span>
                            <div>
                                <p class="item-title">${shelter.name}</p>
                                <p class="item-description">Capacidade: ${shelter.occupied}/${shelter.capacity} | Status: ${shelter.status}</p>
                                <p class="item-distance">Distância: ${distance.toFixed(2)} km</p>
                            </div>
                        `;
                        nearbySheltersList.appendChild(listItem);
                    });
                }
            }

            // Função para renderizar o histórico de notificações
            function renderNotificationsHistory() {
                [notificationsHistoryList, fullNotificationsList].forEach(listElement => {
                    listElement.innerHTML = '';
                    if (notifications.length === 0) {
                        listElement.innerHTML = '<li class="list-item-placeholder">Nenhuma notificação ainda.</li>';
                    } else {
                        notifications.forEach(notification => {
                            const listItem = document.createElement('li');
                            listItem.className = 'list-item';
                            // Define a cor do ícone com base no tipo de notificação
                            const iconClass = notification.type === 'proximity' ? 'blue-icon' : (notification.type === 'alert' ? 'red-icon' : 'default-icon');
                            const iconSVG = notification.type === 'proximity' ? `
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                            ` : `
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell-ring"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.36 17.06a2 2 0 1 0 3.28 0"/><path d="M12 21v-4"/></svg>
                            `;
                            listItem.innerHTML = `
                                <span class="icon-placeholder small-icon ${iconClass}">${iconSVG}</span>
                                <div>
                                    <p class="item-title">${notification.title}</p>
                                    <p class="item-description">${notification.message}</p>
                                </div>
                            `;
                            listElement.appendChild(listItem);
                        });
                    }
                });
            }

            // Função para simular o monitoramento de localização e exibir notificações de proximidade
            function checkProximityAndNotify() {
                if (!userLocation) return;

                mockShelters.forEach(shelter => {
                    const distance = calculateDistance(userLocation.lat, userLocation.lng, shelter.lat, shelter.lng);
                    // Se o usuário está dentro de 5km de um abrigo e ainda não foi notificado sobre ele
                    if (distance <= 5 && !notifications.some(n => n.id === `proximity-${shelter.id}`)) {
                        const newNotification = {
                            id: `proximity-${shelter.id}`,
                            type: 'proximity',
                            title: `Abrigo Próximo: ${shelter.name} está a ${distance.toFixed(2)} km!`,
                            message: `Capacidade: ${shelter.occupied}/${shelter.capacity}. Status: ${shelter.status}.`,
                        };
                        notifications.unshift(newNotification); // Adiciona ao início do array
                        renderNotificationsHistory(); // Atualiza a UI das notificações
                        const iconSVG = `
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                        `;
                        showNotificationModal(newNotification.title, newNotification.message, iconSVG, 'blue-icon');
                    }
                });
                renderNearbyShelters(); // Sempre atualiza a lista de abrigos próximos no dashboard
            }

            // Função para simular atualização da localização do usuário
            function simulateLocationUpdate(lat, lng) {
                userLocation = { lat, lng };
                notifications = []; // Limpa notificações para simular novas ao mudar de local
                userLocationDisplay.textContent = `Localização atual: Lat ${lat.toFixed(5)}, Lng ${lng.toFixed(5)}`;
                userLocationDisplay.classList.remove('hidden');
                checkProximityAndNotify(); // Verifica proximidade com a nova localização
            }

            // Função para mudar a página exibida
            function showPage(pageId) {
                pages.forEach(page => {
                    page.classList.remove('active');
                });
                document.getElementById(pageId).classList.add('active');

                // Atualiza o estado da barra de navegação
                navButtons.forEach(button => {
                    button.classList.remove('active-nav-button');
                });
                document.getElementById(`nav-${pageId.replace('-page', '')}`).classList.add('active-nav-button');
            }

            // Função para renderizar todos os abrigos na página 'Abrigos'
            function renderAllShelters() {
                allSheltersList.innerHTML = '';
                mockShelters.forEach(shelter => {
                    const listItem = document.createElement('li');
                    listItem.className = 'list-item';
                    const statusClass = shelter.status === 'Aberto' ? 'status-open' : (shelter.status === 'Quase Cheio' ? 'status-warning' : 'status-closed');
                    listItem.innerHTML = `
                        <span class="icon-placeholder small-icon blue-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                        </span>
                        <div>
                            <p class="item-title">${shelter.name}</p>
                            <p class="item-description">Capacidade: ${shelter.occupied}/${shelter.capacity} | Status: <span class="${statusClass}">${shelter.status}</span></p>
                            <button class="button primary-button small-button mt-2">Ver no Mapa</button>
                        </div>
                    `;
                    allSheltersList.appendChild(listItem);
                });
            }

            // Event Listeners
            modalCloseButton.addEventListener('click', closeNotificationModal);
            btnSimulateNear.addEventListener('click', () => simulateLocationUpdate(-23.55010, -46.63400));
            btnSimulateFar.addEventListener('click', () => simulateLocationUpdate(-23.60000, -46.80000));

            navButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const pageId = button.id.replace('nav-', '') + '-page';
                    showPage(pageId);
                    if (pageId === 'shelters-page') {
                        renderAllShelters();
                    }
                });
            });
            
            // Configuração inicial
            showPage('dashboard-page');
            renderNearbyShelters();
            renderNotificationsHistory();
        });
    </script>
</body>
</html>

